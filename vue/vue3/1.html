<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1. 背景 | 资料库</title>
    <meta name="generator" content="VuePress 1.8.2">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.css">
    <link rel="icon" href="/longweixia/favicon.ico">
    <meta name="description" content="10点读书">
    
    <link rel="preload" href="/longweixia/assets/css/0.styles.e7f35309.css" as="style"><link rel="preload" href="/longweixia/assets/js/app.30853e2a.js" as="script"><link rel="preload" href="/longweixia/assets/js/2.19b4ab8a.js" as="script"><link rel="preload" href="/longweixia/assets/js/73.fe9c59de.js" as="script"><link rel="prefetch" href="/longweixia/assets/js/10.17389278.js"><link rel="prefetch" href="/longweixia/assets/js/11.13e843aa.js"><link rel="prefetch" href="/longweixia/assets/js/12.9ad5d840.js"><link rel="prefetch" href="/longweixia/assets/js/13.79fcf880.js"><link rel="prefetch" href="/longweixia/assets/js/14.c4361c82.js"><link rel="prefetch" href="/longweixia/assets/js/15.44426049.js"><link rel="prefetch" href="/longweixia/assets/js/16.581eff27.js"><link rel="prefetch" href="/longweixia/assets/js/17.d109ff42.js"><link rel="prefetch" href="/longweixia/assets/js/18.3ec7fcf3.js"><link rel="prefetch" href="/longweixia/assets/js/19.35fd21bb.js"><link rel="prefetch" href="/longweixia/assets/js/20.66a6e34b.js"><link rel="prefetch" href="/longweixia/assets/js/21.71051137.js"><link rel="prefetch" href="/longweixia/assets/js/22.9869167b.js"><link rel="prefetch" href="/longweixia/assets/js/23.2ca1aaba.js"><link rel="prefetch" href="/longweixia/assets/js/24.2232ffb7.js"><link rel="prefetch" href="/longweixia/assets/js/25.e0f0715a.js"><link rel="prefetch" href="/longweixia/assets/js/26.f5c106a0.js"><link rel="prefetch" href="/longweixia/assets/js/27.9e31faa4.js"><link rel="prefetch" href="/longweixia/assets/js/28.113fc19e.js"><link rel="prefetch" href="/longweixia/assets/js/29.bc167a67.js"><link rel="prefetch" href="/longweixia/assets/js/3.88b3d293.js"><link rel="prefetch" href="/longweixia/assets/js/30.03a76239.js"><link rel="prefetch" href="/longweixia/assets/js/31.c81c40f1.js"><link rel="prefetch" href="/longweixia/assets/js/32.bd90225a.js"><link rel="prefetch" href="/longweixia/assets/js/33.1d2874e8.js"><link rel="prefetch" href="/longweixia/assets/js/34.b5be839b.js"><link rel="prefetch" href="/longweixia/assets/js/35.346f3036.js"><link rel="prefetch" href="/longweixia/assets/js/36.81c5024f.js"><link rel="prefetch" href="/longweixia/assets/js/37.c67ed549.js"><link rel="prefetch" href="/longweixia/assets/js/38.77987057.js"><link rel="prefetch" href="/longweixia/assets/js/39.9c901ab8.js"><link rel="prefetch" href="/longweixia/assets/js/4.793f9f6e.js"><link rel="prefetch" href="/longweixia/assets/js/40.3bf5737a.js"><link rel="prefetch" href="/longweixia/assets/js/41.10d00b34.js"><link rel="prefetch" href="/longweixia/assets/js/42.d1c1060a.js"><link rel="prefetch" href="/longweixia/assets/js/43.f8e83df1.js"><link rel="prefetch" href="/longweixia/assets/js/44.0da5d0cd.js"><link rel="prefetch" href="/longweixia/assets/js/45.94d21e4f.js"><link rel="prefetch" href="/longweixia/assets/js/46.9d1beff0.js"><link rel="prefetch" href="/longweixia/assets/js/47.adbb41c5.js"><link rel="prefetch" href="/longweixia/assets/js/48.905e25b7.js"><link rel="prefetch" href="/longweixia/assets/js/49.2763efa3.js"><link rel="prefetch" href="/longweixia/assets/js/5.e7ca5135.js"><link rel="prefetch" href="/longweixia/assets/js/50.ffe0192f.js"><link rel="prefetch" href="/longweixia/assets/js/51.b4a8bbd5.js"><link rel="prefetch" href="/longweixia/assets/js/52.3bf3d83c.js"><link rel="prefetch" href="/longweixia/assets/js/53.c938b0b0.js"><link rel="prefetch" href="/longweixia/assets/js/54.a12149e7.js"><link rel="prefetch" href="/longweixia/assets/js/55.2f8f4d12.js"><link rel="prefetch" href="/longweixia/assets/js/56.b040f922.js"><link rel="prefetch" href="/longweixia/assets/js/57.3565cde1.js"><link rel="prefetch" href="/longweixia/assets/js/58.ddccb3ba.js"><link rel="prefetch" href="/longweixia/assets/js/59.052024c3.js"><link rel="prefetch" href="/longweixia/assets/js/6.a797012b.js"><link rel="prefetch" href="/longweixia/assets/js/60.6ef28404.js"><link rel="prefetch" href="/longweixia/assets/js/61.512be1bf.js"><link rel="prefetch" href="/longweixia/assets/js/62.6e05c141.js"><link rel="prefetch" href="/longweixia/assets/js/63.ca304a0d.js"><link rel="prefetch" href="/longweixia/assets/js/64.6477c58d.js"><link rel="prefetch" href="/longweixia/assets/js/65.e0da78df.js"><link rel="prefetch" href="/longweixia/assets/js/66.e109c264.js"><link rel="prefetch" href="/longweixia/assets/js/67.e498d6df.js"><link rel="prefetch" href="/longweixia/assets/js/68.276ed907.js"><link rel="prefetch" href="/longweixia/assets/js/69.2bc6a533.js"><link rel="prefetch" href="/longweixia/assets/js/7.55c60d55.js"><link rel="prefetch" href="/longweixia/assets/js/70.bb6787af.js"><link rel="prefetch" href="/longweixia/assets/js/71.5ac32627.js"><link rel="prefetch" href="/longweixia/assets/js/72.ba9cb06b.js"><link rel="prefetch" href="/longweixia/assets/js/74.ecb3f57f.js"><link rel="prefetch" href="/longweixia/assets/js/75.0169e10d.js"><link rel="prefetch" href="/longweixia/assets/js/76.f804ad10.js"><link rel="prefetch" href="/longweixia/assets/js/77.49c57594.js"><link rel="prefetch" href="/longweixia/assets/js/78.a2f5ab6e.js"><link rel="prefetch" href="/longweixia/assets/js/79.acb9ebc0.js"><link rel="prefetch" href="/longweixia/assets/js/8.cce1d689.js"><link rel="prefetch" href="/longweixia/assets/js/80.8d936fe0.js"><link rel="prefetch" href="/longweixia/assets/js/81.0e3986b9.js"><link rel="prefetch" href="/longweixia/assets/js/82.774d6e22.js"><link rel="prefetch" href="/longweixia/assets/js/83.c0ddf8bb.js"><link rel="prefetch" href="/longweixia/assets/js/84.5a58253a.js"><link rel="prefetch" href="/longweixia/assets/js/85.20ba04b9.js"><link rel="prefetch" href="/longweixia/assets/js/9.023f9158.js">
    <link rel="stylesheet" href="/longweixia/assets/css/0.styles.e7f35309.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/longweixia/" class="home-link router-link-active"><!----> <span class="site-name">资料库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/longweixia/html/" class="nav-link">
  HTML
</a></div><div class="nav-item"><a href="/longweixia/css/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/longweixia/js/" class="nav-link">
  JS
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/longweixia/html/" class="nav-link">
  HTML
</a></div><div class="nav-item"><a href="/longweixia/css/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/longweixia/js/" class="nav-link">
  JS
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/longweixia/html/" class="sidebar-heading clickable"><span>1. HTML</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/longweixia/css/" class="sidebar-heading clickable"><span>2. CSS</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/longweixia/js/" class="sidebar-heading clickable"><span>3. JS</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/longweixia/vue/" class="sidebar-heading clickable router-link-active open"><span>4. Vue</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>vue基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>面试</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>源码分析</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>VUE3.0</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/longweixia/vue/vue3/1.html" aria-current="page" class="active sidebar-link">VUE3.0指南</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/longweixia/vue/vue3/1.html#_1-背景" class="sidebar-link">1. 背景</a></li><li class="sidebar-sub-header"><a href="/longweixia/vue/vue3/1.html#_2-生命周期的变化" class="sidebar-link">2.生命周期的变化</a></li><li class="sidebar-sub-header"><a href="/longweixia/vue/vue3/1.html#_3-使用proxy代替defineproperty" class="sidebar-link">3.使用proxy代替defineProperty</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/longweixia/vue/vue3/1.html#object-defineproperty-语法" class="sidebar-link">Object.defineProperty()语法</a></li><li class="sidebar-sub-header"><a href="/longweixia/vue/vue3/1.html#proxy的语法" class="sidebar-link">Proxy的语法</a></li></ul></li><li class="sidebar-sub-header"><a href="/longweixia/vue/vue3/1.html#_4-diff算法的提升" class="sidebar-link">4.Diff算法的提升</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/longweixia/vue/vue3/1.html#以往的渲染策略" class="sidebar-link">以往的渲染策略</a></li><li class="sidebar-sub-header"><a href="/longweixia/vue/vue3/1.html#潜在的问题" class="sidebar-link">潜在的问题</a></li><li class="sidebar-sub-header"><a href="/longweixia/vue/vue3/1.html#vue3的突破" class="sidebar-link">Vue3的突破</a></li></ul></li><li class="sidebar-sub-header"><a href="/longweixia/vue/vue3/1.html#_5-typescript的支持" class="sidebar-link">5.typeScript的支持</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/longweixia/vue/vue3/1.html#vue2-存在的问题" class="sidebar-link">vue2 存在的问题</a></li><li class="sidebar-sub-header"><a href="/longweixia/vue/vue3/1.html#如何实现" class="sidebar-link">如何实现</a></li></ul></li><li class="sidebar-sub-header"><a href="/longweixia/vue/vue3/1.html#_6-打包体积变化" class="sidebar-link">6.打包体积变化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/longweixia/vue/vue3/1.html#以前打包存在的问题" class="sidebar-link">以前打包存在的问题</a></li><li class="sidebar-sub-header"><a href="/longweixia/vue/vue3/1.html#vue3是怎么做的" class="sidebar-link">vue3是怎么做的</a></li></ul></li><li class="sidebar-sub-header"><a href="/longweixia/vue/vue3/1.html#_6-开始使用vue3-0" class="sidebar-link">6. 开始使用vue3.0</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/longweixia/vue/vue3/1.html#安装依赖-创建项目" class="sidebar-link">安装依赖，创建项目</a></li></ul></li><li class="sidebar-sub-header"><a href="/longweixia/vue/vue3/1.html#_7-代码解释" class="sidebar-link">7. 代码解释</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/longweixia/vue/vue3/1.html#将vue3的helloworld-vue文件做些改动" class="sidebar-link">将vue3的HelloWorld.vue文件做些改动</a></li><li class="sidebar-sub-header"><a href="/longweixia/vue/vue3/1.html#生命周期的使用" class="sidebar-link">生命周期的使用</a></li></ul></li><li class="sidebar-sub-header"><a href="/longweixia/vue/vue3/1.html#_8-组件api的使用" class="sidebar-link">8. 组件Api的使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/longweixia/vue/vue3/1.html#setup" class="sidebar-link">setup</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Vuex</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/longweixia/ts/" class="sidebar-heading clickable"><span>5. TS</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/longweixia/node/" class="sidebar-heading clickable"><span>6. Node</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/longweixia/business/" class="sidebar-heading clickable"><span>7. 业务</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/longweixia/tools/" class="sidebar-heading clickable"><span>8. 工具</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/longweixia/browser/" class="sidebar-heading clickable"><span>9. 浏览器</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/longweixia/vuePress/" class="sidebar-heading clickable"><span>10. vuePress</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/longweixia/xcx/" class="sidebar-heading clickable"><span>11. 小程序</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/longweixia/note/" class="sidebar-heading clickable"><span>12. 总结</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="_1-背景"><a href="#_1-背景" class="header-anchor">#</a> 1. 背景</h2> <blockquote><p>为什么会有vue3出来，当然是vue2有一些另开发者能明显感知的问题存在。</p></blockquote> <ul><li>Vue 的现有 API 是通过「选项」组织代码的，但是在大部分情况下，通过逻辑考虑来组织代码更有意义。</li> <li>缺少一种比较「干净」的在多个组件之间提取和复用逻辑的机制。</li> <li>类型推断不够友好。</li></ul> <h2 id="_2-生命周期的变化"><a href="#_2-生命周期的变化" class="header-anchor">#</a> 2.生命周期的变化</h2> <blockquote><p>整体来看其实变化不大，使用<code>setup</code>代替了之前的<code>beforeCreate和created</code>，其他生命周期名字有些变化，功能都是没有变化的</p></blockquote> <table><thead><tr><th>Vue2.x</th> <th>Vue3</th></tr></thead> <tbody><tr><td>beforeCreate</td> <td>使用 setup()</td></tr> <tr><td>created</td> <td>使用 setup()</td></tr> <tr><td>beforeMount</td> <td>onBeforeMount</td></tr> <tr><td>mounted</td> <td>onMounted</td></tr> <tr><td>beforeUpdate</td> <td>onBeforeUpdate</td></tr> <tr><td>updated</td> <td>onUpdated</td></tr> <tr><td>beforeDestroy</td> <td>onBeforeUnmount</td></tr> <tr><td>destroyed</td> <td>onUnmounted</td></tr> <tr><td>errorCaptured</td> <td>onErrorCaptured</td></tr></tbody></table> <h2 id="_3-使用proxy代替defineproperty"><a href="#_3-使用proxy代替defineproperty" class="header-anchor">#</a> 3.使用proxy代替defineProperty</h2> <h3 id="object-defineproperty-语法"><a href="#object-defineproperty-语法" class="header-anchor">#</a> Object.defineProperty()语法</h3> <p>重点：vue为什么对数组对象的深层监听无法实现，因为组件每次渲染都是将data里的数据通过defineProperty进行响应式或者双向绑定上，之前没有后加的属性是不会被绑定上，也就不会触发更新渲染</p> <div class="language- extra-class"><pre class="language-text"><code>Object.defineProperty( Obj, 'name', {
    enumerable: true, //可枚举
    configurable: true, //可配置
    // writable:true, //跟可配置不能同时存在
    // value:'name',  //可写死直
    get: function () {
        return def
    },
    set: function ( val ) {
        def = val
    }
} )
</code></pre></div><h3 id="proxy的语法"><a href="#proxy的语法" class="header-anchor">#</a> Proxy的语法</h3> <div class="language- extra-class"><pre class="language-text"><code>//两个参数，对象，13个配置项
const handler = {
    get: function(obj, prop) {
        return prop in obj ? obj[prop] : 37;
    },
    set:function(){ },
    ...13个配置项
};
const p = new Proxy({}, handler);
p.a = 1;
p.b = undefined;
console.log(p.a, p.b);      // 1, undefined
console.log('c' in p, p.c); // false, 37
</code></pre></div><p>对比了上面两种语法是不是就懂了，defineProperty只能响应首次渲染时候的属性，Proxy需要的是整体(如上面例子的p)，不需要关心里面有什么属性，而且Proxy的配置项有13种，可以做更细致的事情，这是之前的defineProperty无法达到的</p> <h2 id="_4-diff算法的提升"><a href="#_4-diff算法的提升" class="header-anchor">#</a> 4.Diff算法的提升</h2> <h3 id="以往的渲染策略"><a href="#以往的渲染策略" class="header-anchor">#</a> 以往的渲染策略</h3> <p>vue2.x提供类似于HTML的模板语法，但是，它是将模板编译成渲染函数来返回虚拟DOM树。Vue框架通过递归遍历两个虚拟DOM树，并比较每个节点上的每个属性，来确定实际DOM的哪些部分需要更新。</p> <h3 id="潜在的问题"><a href="#潜在的问题" class="header-anchor">#</a> 潜在的问题</h3> <p>由于现代JavaScript引擎执行的高级优化，这种有点暴力的算法通常非常快速，但是DOM的更新仍然涉及许多不必要的CPU工作，那么如何解决呢？</p> <h3 id="vue3的突破"><a href="#vue3的突破" class="header-anchor">#</a> Vue3的突破</h3> <p>引用尤雨溪：
为了实现这一点，编译器和运行时需要协同工作：编译器分析模板并生成带有优化提示的代码，而运行时尽可能获取提示并采用快速路径。</p> <p><strong>这里有三个主要的优化</strong>：</p> <ul><li><p>首先，在<code>DOM树级别</code>。我们注意到，在没有动态改变节点结构的模板指令（例如v-if和v-for）的情况下，节点结构保持完全静态。如果我们将一个模板分成由这些结构指令分隔的嵌套“块”，则每个块中的节点结构将再次完全静态。当我们更新块中的节点时，我们不再需要递归遍历DOM树 - 该块内的动态绑定可以在一个平面数组中跟踪。这种优化通过将需要执行的树遍历量减少一个数量级来规避虚拟DOM的大部分开销。</p></li> <li><p>其次，编译器积极地检测模板中的静态节点、子树甚至数据对象，并在生成的代码中将它们提升到渲染函数之外。这样可以避免在每次渲染时重新创建这些对象，从而大大提高内存使用率并减少垃圾回收的频率。</p></li> <li><p>第三，在元素级别。编译器还根据需要执行的更新类型，为每个具有动态绑定的元素生成一个优化标志。例如，具有动态类绑定和许多静态属性的元素将收到一个标志，提示只需要进行类检查。运行时将获取这些提示并采用专用的快速路径。</p></li></ul> <p>综合起来，这些技术大大改进了我们的渲染更新基准，Vue 3有时占用的CPU时间不到Vue 2的十分之一。</p> <h2 id="_5-typescript的支持"><a href="#_5-typescript的支持" class="header-anchor">#</a> 5.typeScript的支持</h2> <h3 id="vue2-存在的问题"><a href="#vue2-存在的问题" class="header-anchor">#</a> vue2 存在的问题</h3> <p>vue2.x中使用的都是js，它本身并没有类型系统这个概念，对于规模很大的项目，没有类型声明，后期维护和代码的阅读都很困难，所以迫切的需要vue能完美支持ts。</p> <p><strong>Tips</strong>： vue2是支持类型的，用的是<code>Facebook</code>的<code>Flow</code>做类型检查，但是因为某些情况下推断有问题。所以引入ts，一个是为了更好的做类型检查，另一个是拥抱ts</p> <h3 id="如何实现"><a href="#如何实现" class="header-anchor">#</a> 如何实现</h3> <p>最终vue3 借鉴了<code>react hook</code>实现了更自由的编程方式，提出了<code>Composition API</code>，Composition API不需要通过指定一长串选项来定义组件，而是允许用户像编写函数一样自由地表达、组合和重用有状态的组件逻辑，同时提供出色的TypeScript支持。</p> <h2 id="_6-打包体积变化"><a href="#_6-打包体积变化" class="header-anchor">#</a> 6.打包体积变化</h2> <h3 id="以前打包存在的问题"><a href="#以前打包存在的问题" class="header-anchor">#</a> 以前打包存在的问题</h3> <p>vue2官方说的运行时打包是23k，但这只是没安装依赖的时候，随着依赖包和框架特性的增多，有时候不必要的，未使用的代码文件都被打包了进去，所以后期项目大了，打包文件会特别多还很大。</p> <h3 id="vue3是怎么做的"><a href="#vue3是怎么做的" class="header-anchor">#</a> vue3是怎么做的</h3> <p>在Vue 3中，我们通过将大多数全局API和内部帮助程序移动到Javascript的module.exports属性上实现这一点。这允许现代模式下的module bundler能够静态地分析模块依赖关系，并删除与未使用的module.exports属性相关的代码。模板编译器还生成了对树抖动友好的代码，只有在模板中实际使用某个特性时，该代码才导入该特性的帮助程序。
尽管增加了许多新特性，但Vue 3被压缩后的基线大小约为10 KB，不到Vue 2的一半。</p> <h2 id="_6-开始使用vue3-0"><a href="#_6-开始使用vue3-0" class="header-anchor">#</a> 6. 开始使用vue3.0</h2> <p>vue3完全兼容vue2，在vue3中依然可以按照vue2的方式去写代码，而且两种写法可以同时存在。
所以目前项目使用Vue2的小伙伴们不用担心存在兼容性问题。</p> <ul><li>1.全新项目可以通过vite脚手架来安装。</li> <li>2.老项目可以直接升级版本</li></ul> <p>以下基于vite脚手架安装的方式展开：</p> <h3 id="安装依赖-创建项目"><a href="#安装依赖-创建项目" class="header-anchor">#</a> 安装依赖，创建项目</h3> <div class="language- extra-class"><pre class="language-text"><code>//hello-vue3 为要创建的项目名字
npm init vite-app hello-vue3
</code></pre></div><p><strong>然后进入项目</strong></p> <div class="language- extra-class"><pre class="language-text"><code>cd hello-vue3
</code></pre></div><p><strong>安装依赖</strong></p> <div class="language- extra-class"><pre class="language-text"><code>npm install
</code></pre></div><p><strong>运行项目</strong></p> <div class="language- extra-class"><pre class="language-text"><code>npm run dev
</code></pre></div><p>可以明显的感知，vite编译的速度非常快。</p> <h2 id="_7-代码解释"><a href="#_7-代码解释" class="header-anchor">#</a> 7. 代码解释</h2> <h3 id="将vue3的helloworld-vue文件做些改动"><a href="#将vue3的helloworld-vue文件做些改动" class="header-anchor">#</a> 将vue3的HelloWorld.vue文件做些改动</h3> <div class="language- extra-class"><pre class="language-text"><code>//dom 里的东西基本上都是没有变的
&lt;template&gt;
  &lt;h1&gt;{{ msg }}&lt;/h1&gt;
  &lt;button @click=&quot;increment&quot;&gt;
    count: {{ state.count }}, double: {{ state.double }},three：{{ three }},refnum：{{refnum}}
  &lt;/button&gt;
&lt;/template&gt;

&lt;script&gt;
//这里就是Vue3的组合Api了，这里跟react的 import { useState ,useEffect } from 'react' 有些类似，需要用啥引啥
import {ref, reactive, computed ,watchEffect,watch} from &quot;vue&quot;;
export default {
  name: &quot;HelloWorld&quot;,
  props: {
    msg: String,
  },
  //上面对比的时候说过，setup相当于beforeCreate 和created，简单理解就是初始化
  setup() { 
  	//这里通过reactive使state成为相应状态（后面会详细介绍）
    const state = reactive({
      count: 0,
      //计算属性computed的使用更灵活了
      double: computed(() =&gt; state.count * 2),
    });
    //computed也可以单独拿出来使用
    const three = computed(() =&gt; state.count * 3)
    //ref跟reactive作用一样都是用来双向绑定的，ref的颗粒度更小（后面详细对比）
	const refnum = ref()
   //这里的watchEffect只要里面的变量发生了改变就会执行,并且第一次渲染会立即执行,没有变化前后返回参数，无法监听整个reactive
    watchEffect(() =&gt; {
      refnum.value = state.count;
      console.log(state, &quot;watchEffect&quot;);
    });
    //watch里第一个参数是监听需要的变量，第二个是执行的回调函数，
    watch(refnum,(a,b)=&gt;{
      console.log(a,b,'watch,a,b')
    })
    //所有的方法里再也不需要用this了，这是很爽的
    function increment() {
      state.count++;
    }
   	//组中模板中需要的变量，都要通过return给暴露出去，就像当初data({return { } }) 是一样的
    return {
      state,
      increment,
      three,
      refnum
    };
  },
};
&lt;/script&gt;
</code></pre></div><h3 id="生命周期的使用"><a href="#生命周期的使用" class="header-anchor">#</a> 生命周期的使用</h3> <p>上面对比的时候也说了，生命周期命名改变了更有语义化了，使用方法也改变（这里有点像react 的useEffect(()=&gt;{ })），使用前需要我们在组合Api里获取。</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;script&gt;
import {
  reactive,
  computed,
  onMounted,
  onBeforeMount,
  onBeforeUpdate,
  onUpdated,
  onUnmounted,
  onBeforeUnmount,
} from &quot;vue&quot;;

export default {
  setup() {
    const state = reactive({
      count: 0,
      double: computed(() =&gt; state.count * 2),
    });
    function increment() {
      state.count++;
    }
    onUpdated(() =&gt; {
      console.log(&quot;onUpdated&quot;);
    });
    onUnmounted(() =&gt; {
      console.log(&quot;onUnmounted&quot;);
    });
    onBeforeUnmount(() =&gt; {
      console.log(&quot;onBeforeUnmount&quot;);
    });
    onBeforeUpdate(() =&gt; {
      console.log(&quot;onBeforeUpdate1&quot;);
    });
    onMounted(() =&gt; {
      console.log(&quot;onMounted&quot;);
    });
    onBeforeMount(() =&gt; {
      console.log(&quot;onBeforeMount&quot;);
    });
    console.log(&quot;setup&quot;);
    return {
      state,
      increment,
    };
  },
};
&lt;/script&gt;
</code></pre></div><p>//生命周期的执行顺序还是和以前一样的。</p> <h2 id="_8-组件api的使用"><a href="#_8-组件api的使用" class="header-anchor">#</a> 8. 组件Api的使用</h2> <h3 id="setup"><a href="#setup" class="header-anchor">#</a> setup</h3> <p>setup替代了以前的 beforeCreate 和 created ，类似于初始化的功能</p> <p>父组件：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;template&gt;
  &lt;img alt=&quot;Vue logo&quot; src=&quot;./assets/logo.png&quot; /&gt;
  &lt;HelloWorld msg=&quot;Baby张  Vue3 RC&quot; /&gt;
  //这里传参给子组件
&lt;/template&gt;
&lt;script&gt;
import HelloWorld from &quot;./components/HelloWorld.vue&quot;;
import { provide } from &quot;vue&quot;;
export default {
  name: &quot;App&quot;,
  components: {
    HelloWorld,
  }
};
&lt;/script&gt;
</code></pre></div><p>子组件：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;template&gt;
  &lt;h1&gt;{{msg}}&lt;/h1&gt;
&lt;/template&gt;

&lt;script&gt;
 export default {
    name: 'HelloWorld',
    props:[&quot;msg&quot;],
	setup(props, ctx) {
        //props 接收的父组件传的参数，这就有点像react的props了
        //ctx 这个参数表示的当前对象实例，也就个是变相的this
		console.log('拿到值==', props.msg, ctx)
    },
      
}
&lt;/script&gt;
</code></pre></div><p>如果你还想要更多当前组件相关的属性，还可以从组合Api 里引用 getCurrentInstance</p> <div class="language- extra-class"><pre class="language-text"><code> import {getCurrentInstance } from &quot;vue&quot;;
 const  all  = getCurrentInstance()
 console.log(all, &quot;app-setup&quot;);
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/longweixia/vue/SourceCode/1.html" class="prev">
        源码分析(1)
      </a></span> <span class="next"><a href="/longweixia/vue/vuex/1copy.html">
        vuex使用指南
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/longweixia/assets/js/app.30853e2a.js" defer></script><script src="/longweixia/assets/js/2.19b4ab8a.js" defer></script><script src="/longweixia/assets/js/73.fe9c59de.js" defer></script>
  </body>
</html>
